<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Crops and Markets</title>

	<!-- Bootstrap Core CSS -->
	<link href="static/css/bootstrap.min.css" rel="stylesheet">

	<!-- Custom CSS -->
	<link href="static/css/simple-sidebar.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
	<![endif]-->

	<!-- Google maps -->
	<script src="https://maps.googleapis.com/maps/api/js"></script>

	<script>

	function codeAddress(address) {
		var address = "Agusto Leguia Norte 101, Santiago, Chile";
		
		geocoder.geocode( { 'address': address}, function(results, status) {
			if (status == google.maps.GeocoderStatus.OK) {
				map.setCenter(results[0].geometry.location);
				var marker = new google.maps.Marker({
					map: map,
					position: results[0].geometry.location
				});
			} else {
				alert('Geocode was not successful for the following reason: ' + status);
			}
		});
	}

	// creates the html content for a marker
	function createInfoWindowContent(heading, info, whereTo){
		var content = '<div id="content">';
		content += '<div id="siteNotice"></div>';
		content += '<h1 id="firstHeading" class="firstHeading">' + heading + '</h1>';
		for (var i=0; i<info.length; i++)
			content += '<p>' + info[i] + '</p>';
		content += '<a href="' + whereTo + '">';
		content += '<button class="btn btn-default">MÃ¡s info</button>';
		content += '</a>';
		content += '</div>';
		content += '</div>';

		return content;
	}

	function initialize(){
		var mapCanvas = document.getElementById("map-canvas");

		// map
		var mapOptions = {
			center: new google.maps.LatLng(-37.092427,-73.1488737),
			zoom: 5,
			mapTypeId: google.maps.MapTypeId.ROADMAP
		}
		var map = new google.maps.Map(mapCanvas, mapOptions);

		// markets
		var geocoder = new google.maps.Geocoder();

		/* 
		var marker = new google.maps.Marker({
			position: new google.maps.LatLng(-31.092427,-71.1488737),
			title: 'Campo A'
		});
		var marker2 = new google.maps.Marker({
			position: new google.maps.LatLng(-41.192427,-73.4688737),
			title: 'Campo B'
		});
		marker.setMap(map);
		marker2.setMap(map);
		*/

		var geocoder = new google.maps.Geocoder();
		// awesome, this works !
		// geocodeAddress(geocoder, map, 'agusto leguia norte 101, santiago, chile');
		{% for geomarker in geomarkers %}
		geocodeAddress(geocoder, map, "{{ geomarker.zone }}", "{{ geomarker.client }}"); 
		{% endfor %}
	}

	/** Transforms an address into a google.maps.Marker into the map. 
	  * @ geocoder: google.maps.Geocoder object to be used.
	  * @ map: the map to be used.
	  * @ address: the address to be geocoded 
	  * @ title: title of the marker that will be created in the map*/
	function geocodeAddress(geocoder, map, address, title){ 
		geocoder.geocode({'address': address}, function(results, status){
			if (status == google.maps.GeocoderStatus.OK){
				var marker = new google.maps.Marker({
					position: results[0].geometry.location, 
					map: map,
					title: title
				});
			}
			else {
				alert('Geocode was not succesful for the following reason:' + status); 
			}
		});
	}

	google.maps.event.addDomListener(window, 'load', initialize);
	</script>

	<style>
	#map-canvas {
		width: 100%;
		height: 700px;
	}
	</style>

</head>

<body>

	<div id="wrapper">

		<!-- Sidebar -->
		{% include "sidebar.html" %}

		<!-- Page Content -->
		<div id="page-content-wrapper">
			<div class="container-fluid">

				<h2>Mapa</h2>
				<br>

				<div id="map-canvas"></div>

				<hr><a href="#menu-toggle" class="btn btn-default" id="menu-toggle">Alternar Menu</a>
			</div>
		</div>

	</div>

	<!-- jQuery -->
	<script src="static/js/jquery.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="static/js/bootstrap.min.js"></script>

	<!-- Menu Toggle Script -->
	<script src="../static/js/menu_toggle.js"></script>


</body>
</html>